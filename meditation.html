<!DOCTYPE html>
<html class="no-js" lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Meditation & Breathing</title>
    <meta name="description" content="Guided meditation, non-guided meditation, and coherent breathing sessions">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">

    <link rel="stylesheet" href="./styles/styles.css">
    <link rel="stylesheet" href="./styles/button-animation.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,600,700" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .meditation-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        .page-title {
            text-align: center;
            margin-bottom: 40px;
            color: #64ffda;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 0 0 20px rgba(100, 255, 218, 0.3);
        }

        .subtitle {
            text-align: center;
            margin-bottom: 50px;
            color: #8892b0;
            font-size: 1.1rem;
            font-weight: 400;
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            justify-content: center;
            margin-bottom: 50px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab-button {
            padding: 15px 30px;
            background: transparent;
            border: none;
            color: #8892b0;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tab-button:hover {
            color: #64ffda;
            background: rgba(100, 255, 218, 0.1);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #64ffda, #00d4aa);
            color: #0f0f23;
            box-shadow: 0 4px 15px rgba(100, 255, 218, 0.3);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Meditation Card */
        .meditation-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Breathing Circle */
        .breathing-circle {
            width: 280px;
            height: 280px;
            border: 4px solid #64ffda;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 40px auto;
            transition: all 3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            background: radial-gradient(circle, rgba(100, 255, 218, 0.1) 0%, transparent 70%);
            box-shadow: 0 0 50px rgba(100, 255, 218, 0.2);
        }

        .breathing-circle.inhale {
            transform: scale(1.3);
            border-color: #64ffda;
            box-shadow: 0 0 60px rgba(100, 255, 218, 0.6);
            background: radial-gradient(circle, rgba(100, 255, 218, 0.2) 0%, transparent 70%);
        }

        .breathing-circle.exhale {
            transform: scale(0.7);
            border-color: #ff6b6b;
            box-shadow: 0 0 60px rgba(255, 107, 107, 0.4);
            background: radial-gradient(circle, rgba(255, 107, 107, 0.1) 0%, transparent 70%);
        }

        .breath-text {
            font-size: 28px;
            font-weight: 600;
            color: white;
            text-align: center;
            margin: 0;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        /* Timer */
        .timer {
            font-size: 3.5rem;
            font-weight: 700;
            color: #64ffda;
            margin: 30px 0;
            font-family: 'Roboto', monospace;
            text-shadow: 0 0 20px rgba(100, 255, 218, 0.5);
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            max-width: 400px;
            margin: 30px auto;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #64ffda, #00d4aa);
            width: 0%;
            transition: width 1s ease;
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(100, 255, 218, 0.5);
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-meditation {
            padding: 15px 30px;
            border: 2px solid #64ffda;
            background: transparent;
            color: #64ffda;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            font-family: 'Montserrat', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn-meditation:hover {
            background: #64ffda;
            color: #0f0f23;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(100, 255, 218, 0.3);
        }

        .btn-meditation:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Settings Panel */
        .settings-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .settings-title {
            color: #64ffda;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .setting-group {
            text-align: center;
        }

        .setting-label {
            color: #8892b0;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 10px;
            display: block;
        }

        .setting-options {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .option-btn {
            padding: 8px 16px;
            border: 1px solid rgba(100, 255, 218, 0.3);
            background: transparent;
            color: #8892b0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .option-btn:hover {
            border-color: #64ffda;
            color: #64ffda;
        }

        .option-btn.active {
            background: #64ffda;
            color: #0f0f23;
            border-color: #64ffda;
        }

        /* Sound Controls */
        .sound-controls {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .sound-btn {
            padding: 12px 20px;
            border: 1px solid rgba(255, 107, 107, 0.3);
            background: transparent;
            color: #8892b0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sound-btn:hover {
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        .sound-btn.active {
            background: #ff6b6b;
            color: #0f0f23;
            border-color: #ff6b6b;
        }

        /* Stats */
        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #64ffda;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #8892b0;
            margin-top: 5px;
        }

        /* Instructions */
        .instructions {
            max-width: 600px;
            text-align: center;
            margin: 30px auto;
            color: #8892b0;
            line-height: 1.7;
            font-size: 1rem;
        }

        /* Guided Meditation Content */
        .guided-content {
            text-align: center;
        }

        .meditation-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .meditation-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .meditation-item:hover {
            background: rgba(100, 255, 218, 0.1);
            border-color: #64ffda;
            transform: translateY(-5px);
        }

        .meditation-item i {
            font-size: 2rem;
            color: #64ffda;
            margin-bottom: 15px;
        }

        .meditation-item h3 {
            color: white;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .meditation-item p {
            color: #8892b0;
            font-size: 0.9rem;
        }

        /* Non-guided Content */
        .non-guided-content {
            text-align: center;
        }

        .timer-settings {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .timer-option {
            padding: 15px 25px;
            border: 2px solid rgba(100, 255, 218, 0.3);
            background: transparent;
            color: #8892b0;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .timer-option:hover {
            border-color: #64ffda;
            color: #64ffda;
        }

        .timer-option.active {
            background: #64ffda;
            color: #0f0f23;
            border-color: #64ffda;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .page-title {
                font-size: 2rem;
            }

            .breathing-circle {
                width: 220px;
                height: 220px;
            }

            .timer {
                font-size: 2.5rem;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .tab-navigation {
                flex-direction: column;
                gap: 5px;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .stats {
                gap: 20px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(100, 255, 218, 0.3);
            border-radius: 50%;
            border-top-color: #64ffda;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Completion Animation */
        .completion-animation {
            animation: pulse 2s ease-in-out;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="nav-bar__wrapper">
            <a href="./index.html" class="hover-underline-animation">Home</a>
            <a href="./index.html#projects-parent" class="hover-underline-animation">Projects</a>
            <a href="./about.html" class="hover-underline-animation">About</a>
        </div>
    </header>

    <main class="meditation-container">
        <div class="container">
            <h1 class="page-title">Meditation & Breathing</h1>
            <p class="subtitle">Find your inner peace through guided meditation, silent practice, or coherent breathing
            </p>

            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-button active" data-tab="guided">
                    <i class="fas fa-headphones"></i> Guided
                </button>
                <button class="tab-button" data-tab="non-guided">
                    <i class="fas fa-moon"></i> Silent
                </button>
                <button class="tab-button" data-tab="breathing">
                    <i class="fas fa-lungs"></i> Breathing
                </button>
            </div>

            <!-- Guided Meditation Tab -->
            <div id="guided" class="tab-content active">
                <div class="meditation-card">
                    <h2 style="color: #64ffda; margin-bottom: 20px;">Guided Meditation</h2>
                    <p class="instructions">
                        Choose from our collection of guided meditation sessions designed to help you relax, focus, and
                        find inner peace.
                    </p>

                    <div class="meditation-list">
                        <div class="meditation-item" data-session="beginner">
                            <i class="fas fa-seedling"></i>
                            <h3>Beginner's Mind</h3>
                            <p>Perfect for newcomers to meditation</p>
                        </div>
                        <div class="meditation-item" data-session="stress">
                            <i class="fas fa-leaf"></i>
                            <h3>Stress Relief</h3>
                            <p>Release tension and find calm</p>
                        </div>
                        <div class="meditation-item" data-session="focus">
                            <i class="fas fa-bullseye"></i>
                            <h3>Focus & Clarity</h3>
                            <p>Sharpen your concentration</p>
                        </div>
                        <div class="meditation-item" data-session="sleep">
                            <i class="fas fa-bed"></i>
                            <h3>Better Sleep</h3>
                            <p>Prepare your mind for rest</p>
                        </div>
                    </div>

                    <div class="controls">
                        <button class="btn-meditation" id="startGuided">Start Session</button>
                        <button class="btn-meditation" id="pauseGuided" disabled>Pause</button>
                        <button class="btn-meditation" id="resetGuided">Reset</button>
                    </div>
                </div>
            </div>

            <!-- Non-guided Meditation Tab -->
            <div id="non-guided" class="tab-content">
                <div class="meditation-card">
                    <h2 style="color: #64ffda; margin-bottom: 20px;">Silent Meditation</h2>
                    <p class="instructions">
                        Practice mindfulness in silence. Choose your session duration and focus on your breath or a
                        chosen object.
                    </p>

                    <div class="timer-settings">
                        <button class="timer-option active" data-duration="300">5 Minutes</button>
                        <button class="timer-option" data-duration="600">10 Minutes</button>
                        <button class="timer-option" data-duration="900">15 Minutes</button>
                        <button class="timer-option" data-duration="1800">30 Minutes</button>
                    </div>

                    <div class="timer" id="timerNonGuided">05:00</div>

                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressNonGuided"></div>
                        </div>
                    </div>

                    <div class="controls">
                        <button class="btn-meditation" id="startNonGuided">Start Session</button>
                        <button class="btn-meditation" id="pauseNonGuided" disabled>Pause</button>
                        <button class="btn-meditation" id="resetNonGuided">Reset</button>
                    </div>
                </div>
            </div>

            <!-- Coherent Breathing Tab -->
            <div id="breathing" class="tab-content">
                <div class="meditation-card">
                    <h2 style="color: #64ffda; margin-bottom: 20px;">Coherent Breathing</h2>
                    <p class="instructions">
                        Follow the breathing circle to achieve optimal heart rate variability and a state of calm.
                    </p>

                    <div class="settings-panel">
                        <h3 class="settings-title">Session Settings</h3>

                        <div class="settings-grid">
                            <div class="setting-group">
                                <label class="setting-label">Duration</label>
                                <div class="setting-options">
                                    <button class="option-btn active" data-duration="300">5 min</button>
                                    <button class="option-btn" data-duration="600">10 min</button>
                                </div>
                            </div>

                            <div class="setting-group">
                                <label class="setting-label">Breathing Ratio</label>
                                <div class="setting-options">
                                    <button class="option-btn active" data-ratio="5:5">5:5</button>
                                    <button class="option-btn" data-ratio="6:6">6:6</button>
                                    <button class="option-btn" data-ratio="4:4">4:4</button>
                                    <button class="option-btn" data-ratio="7:7">7:7</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="timer" id="timerBreathing">05:00</div>

                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressBreathing"></div>
                        </div>
                    </div>

                    <div class="breathing-circle" id="breathingCircle">
                        <p class="breath-text" id="breathText">Ready to begin</p>
                    </div>

                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-value" id="breathCount">0</span>
                            <span class="stat-label">Breaths</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="currentRatio">5:5</span>
                            <span class="stat-label">Ratio</span>
                        </div>
                    </div>

                    <div class="controls">
                        <button class="btn-meditation" id="startBreathing">Start Session</button>
                        <button class="btn-meditation" id="pauseBreathing" disabled>Pause</button>
                        <button class="btn-meditation" id="resetBreathing">Reset</button>
                    </div>

                    <div class="sound-controls">
                        <button class="sound-btn active" id="silenceBtn">
                            <i class="fas fa-volume-mute"></i> Silence
                        </button>
                        <button class="sound-btn" id="natureBtn">
                            <i class="fas fa-tree"></i> Nature
                        </button>
                        <button class="sound-btn" id="ambientBtn">
                            <i class="fas fa-music"></i> Ambient
                        </button>
                        <button class="sound-btn active" id="breathCuesBtn">
                            <i class="fas fa-bell"></i> Cues: ON
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        class MeditationApp {
            constructor() {
                this.currentTab = 'guided';
                this.currentSession = null;
                this.audioContext = null;
                this.audioElements = {};

                this.initializeTabs();
                this.initializeAudio();
                this.bindEvents();
            }

            initializeTabs() {
                const tabButtons = document.querySelectorAll('.tab-button');
                const tabContents = document.querySelectorAll('.tab-content');

                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const tabName = button.getAttribute('data-tab');
                        this.switchTab(tabName);
                    });
                });
            }

            switchTab(tabName) {
                // Update tab buttons
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabName).classList.add('active');

                this.currentTab = tabName;

                // Stop any running session
                if (this.currentSession) {
                    this.currentSession.reset();
                }
            }

            initializeAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.loadAudioFiles();
                } catch (e) {
                    console.log('Audio not supported');
                }
            }

            loadAudioFiles() {
                // Load ambient sounds (fallback to generated tones if files don't exist)
                this.audioElements.nature = new Audio('./assets/sounds/nature-ambient.mp3');
                this.audioElements.ambient = new Audio('./assets/sounds/meditation-music.mp3');
                this.audioElements.inhale = new Audio('./assets/sounds/inhale.mp3');
                this.audioElements.exhale = new Audio('./assets/sounds/exhale.mp3');

                // Set properties
                Object.values(this.audioElements).forEach(audio => {
                    if (audio) {
                        audio.volume = 0.3;
                        if (audio !== this.audioElements.inhale && audio !== this.audioElements.exhale) {
                            audio.loop = true;
                        }
                    }
                });
            }

            bindEvents() {
                // Guided meditation events
                document.getElementById('startGuided').addEventListener('click', () => {
                    this.startGuidedSession();
                });

                // Non-guided meditation events
                document.querySelectorAll('.timer-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        document.querySelectorAll('.timer-option').forEach(opt => opt.classList.remove('active'));
                        e.target.classList.add('active');
                        this.updateNonGuidedTimer();
                    });
                });

                document.getElementById('startNonGuided').addEventListener('click', () => {
                    this.startNonGuidedSession();
                });

                // Breathing events
                document.querySelectorAll('[data-duration]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.target.parentElement.querySelectorAll('.option-btn').forEach(opt => opt.classList.remove('active'));
                        e.target.classList.add('active');
                        this.updateBreathingTimer();
                    });
                });

                document.querySelectorAll('[data-ratio]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.target.parentElement.querySelectorAll('.option-btn').forEach(opt => opt.classList.remove('active'));
                        e.target.classList.add('active');
                        this.updateBreathingRatio();
                    });
                });

                document.getElementById('startBreathing').addEventListener('click', () => {
                    this.startBreathingSession();
                });

                // Sound controls
                document.getElementById('silenceBtn').addEventListener('click', () => this.setActiveSound('silence'));
                document.getElementById('natureBtn').addEventListener('click', () => this.setActiveSound('nature'));
                document.getElementById('ambientBtn').addEventListener('click', () => this.setActiveSound('ambient'));
                document.getElementById('breathCuesBtn').addEventListener('click', () => this.toggleBreathCues());
            }

            startGuidedSession() {
                const selectedSession = document.querySelector('.meditation-item.selected');
                if (!selectedSession) {
                    alert('Please select a guided meditation session first.');
                    return;
                }

                const sessionType = selectedSession.getAttribute('data-session');
                this.currentSession = new GuidedSession(sessionType);
                this.currentSession.start();
            }

            startNonGuidedSession() {
                const duration = parseInt(document.querySelector('.timer-option.active').getAttribute('data-duration'));
                this.currentSession = new NonGuidedSession(duration);
                this.currentSession.start();
            }

            startBreathingSession() {
                const duration = parseInt(document.querySelector('[data-duration].active').getAttribute('data-duration'));
                const ratio = document.querySelector('[data-ratio].active').getAttribute('data-ratio');
                const [inhale, exhale] = ratio.split(':').map(Number);

                this.currentSession = new CoherentBreathing(duration, inhale, exhale);
                this.currentSession.start();
            }

            updateNonGuidedTimer() {
                const duration = parseInt(document.querySelector('.timer-option.active').getAttribute('data-duration'));
                const minutes = Math.floor(duration / 60);
                const seconds = duration % 60;
                document.getElementById('timerNonGuided').textContent =
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            updateBreathingTimer() {
                const duration = parseInt(document.querySelector('[data-duration].active').getAttribute('data-duration'));
                const minutes = Math.floor(duration / 60);
                const seconds = duration % 60;
                document.getElementById('timerBreathing').textContent =
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            updateBreathingRatio() {
                const ratio = document.querySelector('[data-ratio].active').getAttribute('data-ratio');
                document.getElementById('currentRatio').textContent = ratio;
            }

            setActiveSound(soundType) {
                // Update button states
                document.querySelectorAll('.sound-btn').forEach(btn => {
                    if (btn.id !== 'breathCuesBtn') {
                        btn.classList.remove('active');
                    }
                });
                document.getElementById(`${soundType}Btn`).classList.add('active');

                // Stop current audio
                Object.values(this.audioElements).forEach(audio => {
                    if (audio && audio !== this.audioElements.inhale && audio !== this.audioElements.exhale) {
                        audio.pause();
                        audio.currentTime = 0;
                    }
                });

                // Play new audio
                if (soundType !== 'silence' && this.audioElements[soundType]) {
                    this.audioElements[soundType].play().catch(e => {
                        console.log('Audio playback failed:', e);
                    });
                }
            }

            toggleBreathCues() {
                const btn = document.getElementById('breathCuesBtn');
                const isActive = btn.classList.contains('active');

                if (isActive) {
                    btn.classList.remove('active');
                    btn.innerHTML = '<i class="fas fa-bell-slash"></i> Cues: OFF';
                } else {
                    btn.classList.add('active');
                    btn.innerHTML = '<i class="fas fa-bell"></i> Cues: ON';
                }
            }
        }

        class BaseSession {
            constructor() {
                this.isRunning = false;
                this.isPaused = false;
            }

            start() {
                this.isRunning = true;
                this.isPaused = false;
            }

            pause() {
                this.isPaused = !this.isPaused;
            }

            reset() {
                this.isRunning = false;
                this.isPaused = false;
            }
        }

        class GuidedSession extends BaseSession {
            constructor(sessionType) {
                super();
                this.sessionType = sessionType;
                this.duration = 600; // 10 minutes default
                this.currentTime = this.duration;
            }

            start() {
                super.start();
                // Implementation for guided meditation
                console.log(`Starting guided session: ${this.sessionType}`);
            }
        }

        class NonGuidedSession extends BaseSession {
            constructor(duration) {
                super();
                this.duration = duration;
                this.currentTime = duration;
                this.timer = null;
                this.progressEl = document.getElementById('progressNonGuided');
                this.timerEl = document.getElementById('timerNonGuided');
                this.startBtn = document.getElementById('startNonGuided');
                this.pauseBtn = document.getElementById('pauseNonGuided');
                this.resetBtn = document.getElementById('resetNonGuided');

                this.bindEvents();
            }

            bindEvents() {
                this.startBtn.addEventListener('click', () => this.start());
                this.pauseBtn.addEventListener('click', () => this.pause());
                this.resetBtn.addEventListener('click', () => this.reset());
            }

            start() {
                if (!this.isRunning) {
                    super.start();
                    this.startBtn.disabled = true;
                    this.pauseBtn.disabled = false;
                    this.timer = setInterval(() => this.updateTimer(), 1000);
                }
            }

            pause() {
                if (this.isPaused) {
                    this.isPaused = false;
                    this.pauseBtn.textContent = 'Pause';
                    this.timer = setInterval(() => this.updateTimer(), 1000);
                } else {
                    this.isPaused = true;
                    this.pauseBtn.textContent = 'Resume';
                    clearInterval(this.timer);
                }
            }

            reset() {
                super.reset();
                this.currentTime = this.duration;
                clearInterval(this.timer);
                this.startBtn.disabled = false;
                this.pauseBtn.disabled = true;
                this.pauseBtn.textContent = 'Pause';
                this.updateTimer();
                this.updateProgress();
            }

            updateTimer() {
                if (!this.isPaused) {
                    this.currentTime--;
                    const minutes = Math.floor(this.currentTime / 60);
                    const seconds = this.currentTime % 60;
                    this.timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    this.updateProgress();

                    if (this.currentTime <= 0) {
                        this.completeSession();
                    }
                }
            }

            updateProgress() {
                const progress = ((this.duration - this.currentTime) / this.duration) * 100;
                this.progressEl.style.width = `${progress}%`;
            }

            completeSession() {
                clearInterval(this.timer);
                this.isRunning = false;
                this.startBtn.disabled = false;
                this.pauseBtn.disabled = true;
                this.timerEl.textContent = '00:00';
                this.progressEl.style.width = '100%';

                setTimeout(() => {
                    alert('Meditation session complete!');
                }, 500);
            }
        }

        class CoherentBreathing extends BaseSession {
            constructor(duration, inhaleTime, exhaleTime) {
                super();
                this.duration = duration;
                this.inhaleTime = inhaleTime;
                this.exhaleTime = exhaleTime;
                this.currentTime = duration;
                this.breathCount = 0;
                this.currentPhase = 'inhale';
                this.phaseTime = 0;
                this.breathCuesEnabled = true;

                this.timer = null;
                this.breathTimer = null;
                this.progressEl = document.getElementById('progressBreathing');
                this.timerEl = document.getElementById('timerBreathing');
                this.breathingCircle = document.getElementById('breathingCircle');
                this.breathText = document.getElementById('breathText');
                this.breathCountEl = document.getElementById('breathCount');
                this.startBtn = document.getElementById('startBreathing');
                this.pauseBtn = document.getElementById('pauseBreathing');
                this.resetBtn = document.getElementById('resetBreathing');

                this.bindEvents();
            }

            bindEvents() {
                this.startBtn.addEventListener('click', () => this.start());
                this.pauseBtn.addEventListener('click', () => this.pause());
                this.resetBtn.addEventListener('click', () => this.reset());
            }

            start() {
                if (!this.isRunning) {
                    super.start();
                    this.startBtn.disabled = true;
                    this.pauseBtn.disabled = false;
                    this.breathingCircle.classList.add('inhale');
                    this.breathText.textContent = 'Inhale';
                    this.breathCount = 0;
                    this.phaseTime = 0;
                    this.currentPhase = 'inhale';
                    this.updateBreathCounter();
                    this.timer = setInterval(() => this.updateTimer(), 1000);
                    this.breathTimer = setInterval(() => this.updateBreathing(), 100);
                }
            }

            pause() {
                if (this.isPaused) {
                    this.isPaused = false;
                    this.pauseBtn.textContent = 'Pause';
                    this.timer = setInterval(() => this.updateTimer(), 1000);
                    this.breathTimer = setInterval(() => this.updateBreathing(), 100);
                } else {
                    this.isPaused = true;
                    this.pauseBtn.textContent = 'Resume';
                    clearInterval(this.timer);
                    clearInterval(this.breathTimer);
                }
            }

            reset() {
                super.reset();
                this.currentTime = this.duration;
                this.breathCount = 0;
                this.phaseTime = 0;
                this.currentPhase = 'inhale';

                clearInterval(this.timer);
                clearInterval(this.breathTimer);

                this.startBtn.disabled = false;
                this.pauseBtn.disabled = true;
                this.pauseBtn.textContent = 'Pause';

                this.breathingCircle.className = 'breathing-circle';
                this.breathText.textContent = 'Ready to begin';
                this.updateTimer();
                this.updateBreathCounter();
                this.updateProgress();
            }

            updateTimer() {
                if (!this.isPaused) {
                    this.currentTime--;
                    const minutes = Math.floor(this.currentTime / 60);
                    const seconds = this.currentTime % 60;
                    this.timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    this.updateProgress();

                    if (this.currentTime <= 0) {
                        this.completeSession();
                    }
                }
            }

            updateBreathing() {
                if (!this.isPaused) {
                    this.phaseTime += 0.1;
                    const currentBreathTime = this.currentPhase === 'inhale' ? this.inhaleTime : this.exhaleTime;

                    if (this.phaseTime >= currentBreathTime) {
                        this.phaseTime = 0;
                        this.switchPhase();
                    }
                }
            }

            switchPhase() {
                if (this.currentPhase === 'inhale') {
                    this.currentPhase = 'exhale';
                    this.breathingCircle.classList.remove('inhale');
                    this.breathingCircle.classList.add('exhale');
                    this.breathText.textContent = 'Exhale';
                    this.playBreathCue('exhale');
                } else {
                    this.currentPhase = 'inhale';
                    this.breathingCircle.classList.remove('exhale');
                    this.breathingCircle.classList.add('inhale');
                    this.breathText.textContent = 'Inhale';
                    this.breathCount++;
                    this.updateBreathCounter();
                    this.playBreathCue('inhale');
                }
            }

            updateBreathCounter() {
                this.breathCountEl.textContent = this.breathCount;
            }

            updateProgress() {
                const progress = ((this.duration - this.currentTime) / this.duration) * 100;
                this.progressEl.style.width = `${progress}%`;
            }

            playBreathCue(phase) {
                const cuesEnabled = document.getElementById('breathCuesBtn').classList.contains('active');
                if (!cuesEnabled) return;

                // Play generated tone as fallback
                this.playGeneratedTone(phase);
            }

            playGeneratedTone(phase) {
                if (!window.meditationApp.audioContext) return;

                const cueOscillator = window.meditationApp.audioContext.createOscillator();
                const cueGain = window.meditationApp.audioContext.createGain();

                cueOscillator.connect(cueGain);
                cueGain.connect(window.meditationApp.audioContext.destination);

                const frequency = phase === 'inhale' ? 440 : 330;
                const volume = 0.1;
                const duration = 0.3;

                cueOscillator.frequency.setValueAtTime(frequency, window.meditationApp.audioContext.currentTime);
                cueOscillator.type = 'sine';

                cueGain.gain.setValueAtTime(0, window.meditationApp.audioContext.currentTime);
                cueGain.gain.linearRampToValueAtTime(volume, window.meditationApp.audioContext.currentTime + 0.05);
                cueGain.gain.linearRampToValueAtTime(0, window.meditationApp.audioContext.currentTime + duration);

                cueOscillator.start();
                cueOscillator.stop(window.meditationApp.audioContext.currentTime + duration);
            }

            completeSession() {
                clearInterval(this.timer);
                clearInterval(this.breathTimer);
                this.isRunning = false;

                this.startBtn.disabled = false;
                this.pauseBtn.disabled = true;
                this.pauseBtn.textContent = 'Pause';

                this.breathingCircle.className = 'breathing-circle completion-animation';
                this.breathText.textContent = 'Session Complete!';
                this.timerEl.textContent = '00:00';
                this.progressEl.style.width = '100%';

                setTimeout(() => {
                    alert('Congratulations! You have completed your coherent breathing session.');
                }, 500);
            }
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.meditationApp = new MeditationApp();

            // Add click handlers for guided meditation items
            document.querySelectorAll('.meditation-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.meditation-item').forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                });
            });
        });
    </script>
</body>

</html>